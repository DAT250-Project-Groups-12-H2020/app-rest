<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeedApp Vote</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
</head>
<body>
    <!--
    <div id="login_div" class="guest-div">
        <h1>Vote</h1>
        <h2>Poll Title here</h2>

        <button disabled id= "idtest" name="navn" onclick= "x()">Answer</button>
        <button onclick="first()">First Answer</button>
        <button onclick="second()">Second Answer</button>
        <button onclick="sendvotes()">Send Votes</button>

    </div>
    -->
    <!-- https://www.w3schools.com/tags/tryit.asp?filename=tryhtml5_input_type_radio
    -->
    <div id="login_div"> <!-- class="guest-div" -->
        <!-- <h1>Vote</h1> -->
        <h2 id="poll_question">Poll Title here</h2>

        <!--
        <label id = "first_choice" class="container"> Here is the first choice
            <input id="first_checkbox" type="radio" name="radio">
            <span class="checkmark"></span>
        </label>

        <label id = "second_choice" class="container"> Here is the second choice
            <input id="second_checkbox" type="radio" name="radio">
            <span class="checkmark"></span>
        </label>
        -->

        <form id="ans" action="/action_page.php">
            <p>Please select your gender:</p>
            <input type="radio" id="radio_first" name="answer">
            <label id="first_answer">Option 1</label>
            <br>
            <!-- <label for="first_answer">First</label><br> -->
            <input type="radio" id="radio_second" name="answer">
            <label id="second_answer">Option 1</label>
            <!-- <label for="second_answer">Second</label><br> -->
        </form>


        <!--
        <input type="radio" id="first" name="choice" value="first">
        <label for="first">First Answer</label>
        <input type="radio" id="second" name="choice" value="second">
        <label for="second">Second Answer</label><br>
        -->
        <button onclick="send_votes()">Send Vote</button>
    </div>

    <div class="footer">
        <p style="margin: 0; display: inline;">Time remaining: </p>
        <p id="time_remaining" style="color:red;margin: 0; display: inline;" align="right">3 min</p>
    </div>

    <script>
        var url = "http://localhost:8090/";

        let question = document.getElementById('poll_question');

        //let first_checkbox = document.getElementById('first_checkbox');
        //let second_checkbox = document.getElementById('second_checkbox');

        let time_remaining = document.getElementById('time_remaining');

        // id of poll the user is voting on
        let id = localStorage.getItem('id');
        getPoll(id);


        function getPoll(id) {
            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                credentials: 'include'
            };

            fetch(url + "api/v1/polls?id=" + id, requestOptions)
                .then(response => response.text())
                .then(result => {
                    let poll = JSON.parse(result);
                    console.log(poll);

                    question.innerText = poll.question;

                    document.getElementById('first_answer').innerText = poll.firstAnswer;
                    document.getElementById('second_answer').innerText = poll.secondAnswer;

                    if(poll.startDateTime == null && poll.endDateTime == null){
                        time_remaining.innerText = "Always open";
                        time_remaining.style.color = 'green';
                    }else{
                        // Todo: show time remaining, not just end date
                        time_remaining.innerText = poll.endDateTime;
                    }

                    // Radio buttons
                    let first_radio = document.getElementById('radio_first');
                    let second_radio = document.getElementById('radio_second');

                    first_radio.addEventListener('click', () => {
                        console.log(poll.firstAnswer);
                    });
                    second_radio.addEventListener('click', () => {
                        console.log(poll.secondAnswer);
                    });

                    // Todo: Send post request to update poll vote when pressing Send Vote button

                })
                .catch(error => console.log('error', error));


        }

    </script>

    <!--ThecoreFirebaseJSSDKisalwaysrequiredandmustbelistedfirst-->
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

    <script>
        //Yourwebapp'sFirebaseconfiguration
        //ForFirebaseJSSDKv7.20.0andlater,measurementIdisoptional
        var firebaseConfig = {
            apiKey: "AIzaSyBVaiwbASOUfS4GoXaPYS62LgMaxsbSZG0",
            authDomain: "dat250-gr-2-h2020-app.firebaseapp.com",
            databaseURL: "https://dat250-gr-2-h2020-app.firebaseio.com",
            projectId: "dat250-gr-2-h2020-app",
            storageBucket: "dat250-gr-2-h2020-app.appspot.com",
            messagingSenderId: "851900401969",
            appId: "1:851900401969:web:32372ee6e94b18bbb4c810",
            measurementId: "G-03WHQEL0R0"
        };
        //InitializeFirebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <script src="pollvote.js"></script>

</body>
</html>