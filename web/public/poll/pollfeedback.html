<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeedApp Total Votes</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
</head>
<body>

    <div id="login_div" class="guest-div">
        <h1 id="poll_question">Poll Question here</h1>

        <h4>Total votes:</h4>
        <textarea id="total_votes_textarea" cols="40" rows="6" readonly="true" style="resize: none">


            First answer: 2
            Second answer: 5
        </textarea> <br><br>
        <button onclick="pollvote()">Take this poll</button>
    </div>

    <script>
        var url = "http://localhost:8090/";
        let id = window.localStorage.getItem('id');
        getPoll(id);

        function getPoll(id){
            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                credentials: 'include'
            };

            fetch(url + "api/v1/polls?id=" + id, requestOptions)
                .then(response => response.text())
                .then(result => {
                    console.log(result)
                    let poll = JSON.parse(result);
                    console.log(poll);

                    let question = document.getElementById('poll_question');
                    question.innerText = poll.question;

                    let pollVotes = poll.votes;
                    let indexOfNewestId = findIndexOfNewestId(pollVotes);

                    let totalVotesText = document.getElementById('total_votes_textarea');
                    totalVotesText.innerText = poll.firstAnswer + ":" + pollVotes[indexOfNewestId].firstVotes;
                    totalVotesText.value += '\r\n' + poll.secondAnswer + ":" + pollVotes[indexOfNewestId].secondVotes;

                    let time_remaining = document.getElementById('time_remaining');
                    time_remaining.innerText = "Time remaining: " + poll.endDateTime;
                })
                .catch(error => console.log('error', error));
        }


        function findIndexOfNewestId(pollVotes){
            let indexOfNewestId = 0;
            let newestId = 0;

            for(let i = 0; i < pollVotes.length; i++){
                if(pollVotes[i].id > newestId){
                    indexOfNewestId = i;
                    newestId = pollVotes[i].id;
                }
            }
            return indexOfNewestId;
        }

    </script>








        <!--
    <script>
        var toInsert = document.createElement("div");
        toInsert.innerHTML = "Time remaining: 23 hours, 5 min";
        toInsert.style.position = "absolute";
        toInsert.style.bottom = "0px";
        toInsert.style.textAlign = "center";
        toInsert.style.width = "100%";
        document.body.appendChild(toInsert);
    </script>
    -->

    <div id="time_remaining" class="footer">
        <p>Time remaining: 23 hours, 5 min. Back to <a href="polloverview.html">poll overview</a>.</p>
    </div>

    <!--ThecoreFirebaseJSSDKisalwaysrequiredandmustbelistedfirst-->
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

    <script>
        //Yourwebapp'sFirebaseconfiguration
        //ForFirebaseJSSDKv7.20.0andlater,measurementIdisoptional
        var firebaseConfig = {
            apiKey: "AIzaSyBVaiwbASOUfS4GoXaPYS62LgMaxsbSZG0",
            authDomain: "dat250-gr-2-h2020-app.firebaseapp.com",
            databaseURL: "https://dat250-gr-2-h2020-app.firebaseio.com",
            projectId: "dat250-gr-2-h2020-app",
            storageBucket: "dat250-gr-2-h2020-app.appspot.com",
            messagingSenderId: "851900401969",
            appId: "1:851900401969:web:32372ee6e94b18bbb4c810",
            measurementId: "G-03WHQEL0R0"
        };
        //InitializeFirebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <script src="../index.js"></script>

</body>
</html>