<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeedApp Edit Poll</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
</head>
<body>

<div>
    <h1>Edit Poll</h1>
    <input type="poll code" id="poll_question_field"/><br>
    <input type="poll code" id="first_ans_field"/><br>
    <input type="poll code" id="second_ans_field"/><br>

    <!--
    <form>
        <label for="start">Select Start time:</label>
        <input type="date" id="start" name="day">
    </form>

    <form>
        <label for="end">Select End time:</label>
        <input type="date" id="end" name="day">
    </form>
    -->

    <label id="time_remaining">Time remaining: </label><br>

    <input type="checkbox" id="private" name="private" value="false">
    <label for="private">Private</label><br>

    <button onclick="editPoll()" type="button">Edit Poll</button>
    <br><br>
    <button onclick="deletePoll()" type="button" style="color: #ff0000">Delete Poll</button>
</div>

<div class="footer">
    <p>Back to <a href="ownpollsoverview.html">poll overview</a>.</p>
</div>

<script>
    let url = 'http://localhost:8090';
    let id = window.localStorage.getItem('id');

    let pollQuestion = document.getElementById("poll_question_field");
    let firstAnswer = document.getElementById("first_ans_field");
    let secondAnswer = document.getElementById("second_ans_field");
    let private = document.getElementById("private");

    var requestOptions = {
        method: 'GET',
        redirect: 'follow',
        credentials: 'include'
    };

    fetch(url + "/api/v1/polls?id=" + id, requestOptions)
        .then(response => response.text())
        .then(result => {
            poll = JSON.parse(result);

            pollQuestion.value = poll.question;
            firstAnswer.value = poll.firstAnswer;
            secondAnswer.value = poll.secondAnswer;
            private.checked = poll.private;

            if(poll.endDateTime == null){
                document.getElementById('time_remaining').innerText = "Time remaining: " + "Unlimited";
            }else{
                document.getElementById('time_remaining').innerText = "Time remaining: " + poll.endDateTime;
            }
        })
        .catch(error => console.log('error', error));


    function editPoll() {
        let pollBody = {
            "question": pollQuestion.value,
            "firstAnswer": firstAnswer.value,
            "secondAnswer": secondAnswer.value,
            "private": private.checked,
        }

        if (pollQuestion.value === ""
            || firstAnswer.value === ""
            || secondAnswer.value === ""
        ) {
            alert("Please make sure to choose a question and answers");
        } else {
            pollPUT(pollBody);
        }
    }
    function pollPUT(pollBody) {
        var requestOptions = {
            method: 'PUT',
            body: JSON.stringify(pollBody),
            redirect: 'follow',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json'
            }
        };

        fetch(url + "/api/v1/polls/" + id, requestOptions)
            .then(response => response.text())
            .then(result => {
                console.log(result)
                location.href = "ownpollsoverview.html";
            })
            .catch(error => console.log('error', error));
    }
</script>

<script>
    function deletePoll(){
        var requestOptions = {
            method: 'DELETE',
            redirect: 'follow',
            credentials: 'include'
        };

        fetch(url + "/api/v1/polls/" + id, requestOptions)
            .then(response => response.text())
            .then(result => {
                console.log(result)
                location.href = "ownpollsoverview.html";
            })
            .catch(error => console.log('error', error));
    }
</script>


<!--The core Firebase JS SDK is always required and must be listed first-->
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

<script>
    // Your webapp's Firebase configuration
    //For Firebase JS SDK v7.20.0 and later, measurement Id is optional
    var firebaseConfig = {
        apiKey: "AIzaSyBVaiwbASOUfS4GoXaPYS62LgMaxsbSZG0",
        authDomain: "dat250-gr-2-h2020-app.firebaseapp.com",
        databaseURL: "https://dat250-gr-2-h2020-app.firebaseio.com",
        projectId: "dat250-gr-2-h2020-app",
        storageBucket: "dat250-gr-2-h2020-app.appspot.com",
        messagingSenderId: "851900401969",
        appId: "1:851900401969:web:32372ee6e94b18bbb4c810",
        measurementId: "G-03WHQEL0R0"
    };
    //Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
</script>
<script src="pollvote.js"></script>

</body>
</html>