<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeedApp Poll Code</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
</head>
<body>

    <div id="login_div" class="guest-div">
        <h1>FeedApp Poll Code</h1>
        <input type="poll code" placeholder="Poll Code" id="poll_field" value=""/>
        <br><br>
        <button onclick="goToPoll()">Enter</button>

        <br>
        <div class="button">
            <p>Go to <a href="../poll/polloverview.html">Poll Overview</a>.</p>
        </div>
    </div>

    <div class="footer">
    <p>Don't have poll code? <a href="../index.html">Log in/sign up</a> and get poll overview!</p>
    </div>

    <!--ThecoreFirebaseJSSDKisalwaysrequiredandmustbelistedfirst-->
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

    <script>
        var url = "http://localhost:8090/";

        function goToPoll(){
            let id = document.getElementById('poll_field').value;

            // Bruker id som pollcode
            var requestOptions = {
                method: 'GET',
                redirect: 'follow',
                credentials: 'include'
            };
            console.log(id);

            fetch(url + "api/v1/polls?id=" + id, requestOptions)
                .then(response => response.text())
                .then(result => {

                    result = JSON.parse(result);
                    console.log("status:");
                    console.log(result.status);

                    if(result.status == 404){
                        // can't access poll with the id given
                        alert("You can't access this poll");
                    }else{
                        // go to poll
                        window.localStorage.setItem('id', result.id);
                        location.href = "pollvote.html";
                    }


                })
                .catch(error => console.log('error', error));
        }

    </script>

    <script>
        //Yourwebapp'sFirebaseconfiguration
        //ForFirebaseJSSDKv7.20.0andlater,measurementIdisoptional
        var firebaseConfig = {
            apiKey: "AIzaSyBVaiwbASOUfS4GoXaPYS62LgMaxsbSZG0",
            authDomain: "dat250-gr-2-h2020-app.firebaseapp.com",
            databaseURL: "https://dat250-gr-2-h2020-app.firebaseio.com",
            projectId: "dat250-gr-2-h2020-app",
            storageBucket: "dat250-gr-2-h2020-app.appspot.com",
            messagingSenderId: "851900401969",
            appId: "1:851900401969:web:32372ee6e94b18bbb4c810",
            measurementId: "G-03WHQEL0R0"
        };
        //InitializeFirebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();
    </script>
    <script src="../index.js"></script>

</body>
</html>