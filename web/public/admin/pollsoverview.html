<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FeedApp Poll Overview</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="../style.css" />
</head>
<body>

<div id="login_div" class="guest-div">
    <h1>All Public Polls</h1>
</div>
<table id="table" style="width:100%">
    <tr>
        <th>Poll Question</th>
        <!-- <th>Owner</th> -->
    </tr>
</table>

<div id="poll_div" class="poll-overview-div">
    <button onclick="pollcreate()">Create Poll</button>
</div>

<div class="button">
    <p>Go to <a href="../login/loggedinoverview.html">Logged in menu</a>.</p>
</div>

<!--ThecoreFirebaseJSSDKisalwaysrequiredandmustbelistedfirst-->
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-database.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-analytics.js"></script>

<script>
    //Yourwebapp'sFirebaseconfiguration
    //ForFirebaseJSSDKv7.20.0andlater,measurementIdisoptional
    var firebaseConfig = {
        apiKey: "AIzaSyBVaiwbASOUfS4GoXaPYS62LgMaxsbSZG0",
        authDomain: "dat250-gr-2-h2020-app.firebaseapp.com",
        databaseURL: "https://dat250-gr-2-h2020-app.firebaseio.com",
        projectId: "dat250-gr-2-h2020-app",
        storageBucket: "dat250-gr-2-h2020-app.appspot.com",
        messagingSenderId: "851900401969",
        appId: "1:851900401969:web:32372ee6e94b18bbb4c810",
        measurementId: "G-03WHQEL0R0"
    };
    //InitializeFirebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
</script>
<script src="../index.js"></script>
<script src="../poll/poll.js"></script>



<script>
    var url = "http://localhost:8090";

    function getAllPublicAndPrivatePolls(){
        var requestOptions = {
            method: 'GET',
            redirect: 'follow',
            credentials: 'include'
        };

        fetch(url + "/api/v1/polls/private", requestOptions)
            .then(response => response.text())
            .then(result => {
                console.log(result)

                result = JSON.parse(result);

                polls = result.content;
                console.log(polls);

                let table = document.getElementById('table');

                for(let p of polls){
                    // Insert poll to table
                    table.insertRow();
                    let newCell = table.rows[table.rows.length - 1].insertCell();
                    newCell.textContent = p.question;
                    newCell.addEventListener('click', () => {
                        window.localStorage.setItem('id', p.id);
                        location.href = "../poll/pollvote.html";
                    })

                    if(isOpen(result)){
                        newCell.style.color = "green";
                    }else{
                        newCell.style.color = "red";
                    }

                    // New column/cell to the right
                    let pollEdit = table.rows[table.rows.length - 1].insertCell();
                    pollEdit.textContent = "Edit";
                    pollEdit.addEventListener('click', () => {
                        window.localStorage.setItem('id', p.id);
                        console.log("Edit");
                        location.href = "../poll/editpoll.html";
                    })
                }

                // Todo: Create 'next' and 'back' buttons so that more polls can be shown
                if(!result.empty){
                    // Show 'next' button
                    console.log("Show 'next' button");
                }
                if(result.pageable.pageNumber > 0){
                    // Show 'back' button
                    console.log("Show 'back' button");
                }
            })
            .catch(error => console.log('error', error));
    }


    function getAllPublicPolls() {
        var requestOptions = {
            method: 'GET',
            redirect: 'follow',
            credentials: 'include'
        };

        let page = 0;

        fetch(url + "/api/v1/polls/public?size=10&page=" + page + "&sort=id,desc", requestOptions)
            .then(response => response.text())
            .then(result => {
                console.log(result)
                result = JSON.parse(result);

                polls = result.content;
                console.log(polls);

                let table = document.getElementById('table');

                for(let p of polls){
                    // Insert poll to table
                    table.insertRow();
                    let newCell = table.rows[table.rows.length - 1].insertCell();
                    newCell.textContent = p.question;
                    newCell.addEventListener('click', () => {
                        window.localStorage.setItem('id', p.id);
                        location.href = "pollvote.html";
                    })

                    if(isOpen(result)){
                        newCell.style.color = "green";
                    }else{
                        newCell.style.color = "red";
                    }
                }

                // Todo: Create 'next' and 'back' buttons so that more polls can be shown
                if(!result.empty){
                    // Show 'next' button
                    console.log("Show 'next' button");
                }
                if(result.pageable.pageNumber > 0){
                    // Show 'back' button
                    console.log("Show 'back' button");
                }
            })
            .catch(error => console.log('error', error));
    }

    window.onload = (event) => {
        //getAllPublicPolls();
        getAllPublicAndPrivatePolls();
    };


</script>


</body>
</html>